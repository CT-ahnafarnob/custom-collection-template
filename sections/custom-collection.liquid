<section class="custom-page-width">


  <div class="filter-and-section">


  <div class="filter">
     <!-- FILTER SIDEBAR -->
    <aside class="filter-sidebar">
        
        <!-- Header with Clear Filters -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0;">Filters</h2>
          
          {% if collection.filters.size > 0 %}
            {% assign has_active_filters = false %}
            {% for filter in collection.filters %}
              {% if filter.active_values.size > 0 %}
                {% assign has_active_filters = true %}
              {% endif %}
            {% endfor %}
            
            {% if has_active_filters %}
              <a href="{{ collection.url }}" style="font-size: 14px; color: #666; text-decoration: underline;">Clear all</a>
            {% endif %}
          {% endif %}
        </div>
        
      
        <!-- Filter Form -->
            <form method="get" action="{{ collection.url }}" id="filterForm">
                
                {% for filter in collection.filters %}
                    <div class="filter-group">
                    <h3>{{ filter.label }}</h3>
                    
                    {% if filter.type == 'list' %}
                        <!-- LIST FILTER (Checkboxes) -->
                        {% for value in filter.values %}
                        <div class="filter-option">
                            <input 
                            type="checkbox" 
                            id="Filter-{{ filter.label }}-{{ forloop.index }}"
                            name="{{ value.param_name }}"
                            value="{{ value.value }}"
                            {% if value.active %}checked{% endif %}
                            >
                            <label for="Filter-{{ filter.label }}-{{ forloop.index }}">
                            {{ value.label }} ({{ value.count }})
                            </label>
                        </div>
                        {% endfor %}
                        
                    {% elsif filter.type == 'price_range' %}
                        <!-- PRICE RANGE FILTER -->
                        <div class="price-inputs">
                        <div>
                            <label>From ($)</label>
                            <input 
                            type="number" 
                            name="{{ filter.min_value.param_name }}"
                            placeholder="0"
                            min="0"
                            step="0.01"
                            {% if filter.min_value.value %}
                                value="{{ filter.min_value.value | divided_by: 100.0 }}"
                            {% endif %}
                            >
                        </div>
                        <div>
                            <label>To ($)</label>
                            <input 
                            type="number" 
                            name="{{ filter.max_value.param_name }}"
                            placeholder="Max"
                            min="0"
                            step="0.01"
                            {% if filter.max_value.value %}
                                value="{{ filter.max_value.value | divided_by: 100.0 }}"
                            {% endif %}
                            >
                        </div>
                        </div>
                        
                    {% endif %}
                    </div>
                {% endfor %}
                
                <button type="submit" style="width: 100%; padding: 12px; background: #000; color: #fff; border: none; cursor: pointer; margin-top: 10px;">Apply Filters</button>
                
            </form>


        <!-- Active Filters Display -->
        {% if has_active_filters %}
          <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
            <h4 style="margin-bottom: 10px; font-size: 14px;">Active Filters:</h4>
            
            {% for filter in collection.filters %}
              {% for value in filter.active_values %}
                <div style="display: inline-block; background: #000; color: #fff; padding: 5px 10px; margin: 5px 5px 0 0; font-size: 12px; border-radius: 3px;">
                  {{ filter.label }}: {{ value.label }}
                  <a href="{{ value.url_to_remove }}" style="color: #fff; margin-left: 5px; text-decoration: none; font-weight: bold;">✕</a>
                </div>
              {% endfor %}
            {% endfor %}
          </div>
        {% endif %}
        
      </aside>
      
  </div>

  {% comment %} Main Section {% endcomment %}
  <div class="section">
    <div class="section-heading"><h3>{{collection.title}}</h3>
    <p>{{collection.description}}</p></div>
 
    
    <div class="collection-wrapper">
      
     
      <!-- PRODUCTS AREA -->
      <div class="products-container">
        <h2>{{collection.title}}</h2>
        {% paginate collection.products by 12 %}
          
          <div class="products-grid">
            {% if collection.products.size > 0 %}
              {% for product in collection.products %}
                
                <div class="product-card">
                  
                  <!-- Product Image -->
                  <div class="product-image">
                    {% if product.featured_image %}
                      <a href="{{ product.url }}">
                       <img
                            src="{{ product.featured_image | image_url: width: 400 }}"
                            alt="{{ product.title | escape }}"
                            width="400"
                            height="{{ product.featured_image.height | divided_by: product.featured_image.width | times: 400 | round }}"
                            loading="lazy"
                        />
                      </a>
                    {% else %}
                      <div class="product-image-placeholder">No image</div>
                    {% endif %}
                  </div>
                  
                  <!-- Product Info -->
                  <div class="product-info">
                    <h2>
                      <a href="{{ product.url }}">{{ product.title }}</a>
                    </h2>
                    
                    <!-- Product Price -->
                    <div class="product-price">
                      {% if product.compare_at_price > product.price %}
                        <!-- On Sale -->
                        <span class="price-sale">{{ product.price | money }}</span>
                        <span class="price-compare">{{ product.compare_at_price | money }}</span>
                      {% else %}
                        <!-- Regular Price -->
                        <span class="price-regular">{{ product.price | money }}</span>
                      {% endif %}
                    </div>
                    
                    {% if product.description != blank %}
                      <p class="product-description">{{ product.description | strip_html | truncate: 100 }}</p> 
                    {% endif %}
                  </div>

                <!-- Quick Add to Cart -->
             <!-- Add to Cart Button -->
                {% if product.available %}
                {% if product.has_only_default_variant %}
                    <!-- Single variant - quick add -->
                    <button 
                    class="add-to-cart-btn"
                    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    data-product-title="{{ product.title | escape }}"
                    >
                    Add to Cart
                    </button>
                {% else %}
                    <!-- Multiple variants - go to product page -->
                    <a href="{{ product.url }}" class="add-to-cart-btn add-to-cart-link">
                    Select Variant
                    </a>
                {% endif %}
                {% else %}
                <!-- Sold out -->
                <button class="add-to-cart-btn add-to-cart-sold-out" disabled>
                    Sold Out
                </button>
                {% endif %}
                  
                </div>
              {% endfor %}
            {% else %}
              <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #666;">
                <h3>No products found</h3>
                <p>Try adjusting your filters or <a href="{{ collection.url }}" style="color: #000; text-decoration: underline;">clear all filters</a>.</p>
              </div>
            {% endif %}
          </div>
          
          {% if paginate.pages > 1 %}
            <div class="pagination">
              {% if paginate.previous %}
                <a href="{{paginate.previous.url}}">← Previous</a> 
              {% endif %}
              <span>Page {{paginate.current_page}} of {{paginate.pages}}</span>
              {% if paginate.next %}
                <a href="{{paginate.next.url}}">Next →</a>
              {% endif %}
            </div>
          {% endif %}
          
        {% endpaginate %}
      </div>
      
    </div>
  </div>
      

</div>
</section>

<!-- Add to cart product JS -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Only target actual "Add to Cart" buttons, not "Select Options" links
    const addToCartButtons = document.querySelectorAll('.add-to-cart-btn:not(.add-to-cart-link):not(.add-to-cart-sold-out)');
    
    addToCartButtons.forEach(button => {
      button.addEventListener('click', function() {
        const variantId = this.getAttribute('data-variant-id');
        const productTitle = this.getAttribute('data-product-title');
        
        // Disable button and show loading state
        this.disabled = true;
        this.textContent = 'Adding...';
        
        // Add to cart via Shopify Ajax API
        fetch('/cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            id: variantId,
            quantity: 1
          })
        })
        .then(response => response.json())
        .then(data => {
          // Success - change to "Added to Cart"
          this.textContent = 'Added to Cart';
          
          // Keep disabled for 2 seconds, then reset
          setTimeout(() => {
            this.disabled = false;
            this.textContent = 'Add to Cart';
          }, 5000);
          
          // Optional: Show alert
          alert(productTitle + ' added to cart!');
          
          // Trigger cart refresh
          document.documentElement.dispatchEvent(new CustomEvent('cart:refresh'));
        })
        .catch(error => {
          // Error handling
          console.error('Error:', error);
          this.disabled = false;
          this.textContent = 'Error - Try Again';
          
          setTimeout(() => {
            this.textContent = 'Add to Cart';
          }, 2000);
        });
      });
    });
  });
</script>




<!-- Complete CSS -->
<style>
  /* Layout */
  .custom-page-width{
    max-width: 1400px;
    margin: 0 auto;
  }
  .filter-and-section {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding-top: 20px;
    gap: 20px;
  }
  .collection-wrapper {
    display: flex;
    gap: 30px;
    padding: 20px;
  }
  .section-heading {
    padding: 0 20px;
  }
  .section-heading h3{
    margin: 0;
    text-align: center;
  }
  .filter-sidebar {
    width: 250px;
    flex-shrink: 0;
  }
  
  .products-container {
    flex: 1;
  }
  
  /* Filters */
  .filter-group {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #ddd;
  }
  
  .filter-group:last-child {
    border-bottom: none;
  }
  
  .filter-group h3 {
    font-size: 16px;
    margin-bottom: 12px;
  }
  
  .filter-option {
    margin: 8px 0;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .filter-option input[type="checkbox"] {
    cursor: pointer;
  }
  
  .filter-option label {
    cursor: pointer;
    font-size: 14px;
  }
  
  .price-inputs {
    display: flex;
    gap: 10px;
  }
  
  .price-inputs input {
    width: 80px;
    padding: 5px;
    border: 1px solid #ddd;
  }
  
  /* Products Grid */
  .products-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 40px;
  }
  
  /* Product Card */
  .product-card {
    border: 1px solid #ddd;
    padding: 0;
    overflow: hidden;
    transition: box-shadow 0.3s;
    display: flex;
    flex-direction: column;
  }
  
  .product-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  
  /* Product Image */
  .product-image {
    position: relative;
    width: 100%;
    aspect-ratio: 1 / 1;
    background: #f5f5f5;
    overflow: hidden;
  }
  
  .product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    transition: transform 0.3s;
  }
  
  .product-card:hover .product-image img {
    transform: scale(1.05);
  }
  
  .product-image-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #999;
    font-size: 14px;
  }
  
  /* Product Info */
  .product-info {
    padding: 15px;
  }
  
  .product-info h2 {
    font-size: 16px;
    margin-bottom: 8px;
    line-height: 1.3;
  }
  
  .product-info h2 a {
    text-decoration: none;
    color: #000;
  }
  
  .product-info h2 a:hover {
    text-decoration: underline;
  }
  
  /* Product Price */
  .product-price {
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .price-regular {
    font-size: 18px;
    font-weight: 600;
    color: #000;
  }
  
  .price-sale {
    font-size: 18px;
    font-weight: 600;
    color: #e74c3c;
  }
  
  .price-compare {
    font-size: 14px;
    color: #999;
    text-decoration: line-through;
  }
  
  /* Product Description */
  .product-description {
    font-size: 14px;
    color: #666;
    line-height: 1.5;
    margin: 0;
  }

  /* Add to Cart Button */
.add-to-cart-btn {
  display: block;
  width: 100%;
  padding: 12px;
  margin-top: 15px;
  background: #000;
  color: #fff;
  text-align: center;
  text-decoration: none;
  border: none;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.3s;
  border-radius: 4px;
  margin-top: auto;
}

.add-to-cart-btn:hover:not(:disabled) {
  background: #333;
  transform: translateY(-2px);
}

.add-to-cart-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.add-to-cart-btn.sold-out {
  background: #ccc;
  color: #666;
}
  
  /* Pagination */
  .pagination {
    display: flex;
    gap: 15px;
    align-items: center;
    justify-content: center;
    margin-top: 20px;
  }
  
  .pagination a {
    padding: 8px 16px;
    border: 1px solid #000;
    text-decoration: none;
    color: #000;
  }
  
  .pagination a:hover {
    background: #000;
    color: #fff;
  }
  
  .pagination span {
    font-size: 14px;
    color: #666;
  }

  
  
  /* Responsive */
  @media (max-width: 768px) {
    .collection-wrapper {
      flex-direction: column;
    }
    
    .filter-sidebar {
      width: 100%;
    }
    
    .products-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
  }
  
  @media (max-width: 480px) {
    .products-grid {
      grid-template-columns: 1fr;
    }
  }
</style>