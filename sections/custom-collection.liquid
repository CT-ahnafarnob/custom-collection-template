<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

{{ 'custom-collection.css' | asset_url | stylesheet_tag }}

<section class="custom-page-width">


  <div class="filter-and-section">


  <div class="filter">
     {% comment %} FILTER SIDEBAR {% endcomment %}
    <aside class="filter-sidebar">
        
      {% comment %} Close Button (mobile only) {% endcomment %}
        <button class="filter-close-btn" id="filterCloseBtn">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>


        {% comment %} Header with Clear Filters {% endcomment %}
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0;">Filters</h2>
          
          {% if collection.filters.size > 0 %}
            {% assign has_active_filters = false %}
            {% for filter in collection.filters %}
              {% if filter.type == 'price_range' %}
                {% if filter.min_value.value or filter.max_value.value %}
                  {% assign has_active_filters = true %}
                {% endif %}
              {% elsif filter.active_values.size > 0 %}
                {% assign has_active_filters = true %}
              {% endif %}
            {% endfor %}
            
              {% comment %} Check if sort is active {% endcomment %}
              {% if collection.sort_by != blank and collection.sort_by != 'manual' %}
                {% assign has_active_filters = true %}
              {% endif %}

           
          {% endif %}
        </div>
        
      
        {% comment %} Filter Form {% endcomment %}
      <form method="get" action="{{ collection.url }}" id="filterForm">
    
      {% for filter in collection.filters %}
        <div class="filter-group">
        <h3>{{ filter.label }}</h3>
        
        {% if filter.type == 'list' %}
            {% comment %} LIST FILTER (Checkboxes) {% endcomment %}
            {% for value in filter.values %}
            <div class="filter-option">
                <input 
                type="checkbox" 
                id="Filter-{{ filter.label }}-{{ forloop.index }}"
                name="{{ value.param_name }}"
                value="{{ value.value }}"
                {% if value.active %}checked{% endif %}
                >
                <label for="Filter-{{ filter.label }}-{{ forloop.index }}">
                {{ value.label }} ({{ value.count }})
                </label>
            </div>
            {% endfor %}
            
        {% elsif filter.type == 'price_range' %}
            {% comment %} PRICE RANGE FILTER {% endcomment %}
            <div class="price-inputs">
            <div>
                <label>From ($)</label>
                <input 
                type="number" 
                name="{{ filter.min_value.param_name }}"
                placeholder="0"
                pattern="[0-9]*\.?[0-9]*"
                inputmode="decimal"
                {% if filter.min_value.value %}
                    value="{{ filter.min_value.value | divided_by: 100}}"
                {% endif %}
                >
            </div>
            <div>
                <label>To ($)</label>
                <input 
                type="number" 
                name="{{ filter.max_value.param_name }}"
                placeholder="Max"
                pattern="[0-9]*\.?[0-9]*"
                inputmode="decimal"
                {% if filter.max_value.value %}
                    value="{{ filter.max_value.value | divided_by: 100 }}"
                {% endif %}
                >
            </div>
            </div>
            
        {% endif %}
        </div>
    {% endfor %}

    {% comment %} Sort By Filter {% endcomment %}
      <div class="filter-group">
        <h3>Sort By</h3>
        <select name="sort_by" class="sort-select">
          <option value="manual" {% if collection.sort_by == 'manual' %}selected{% endif %}>
            Featured
          </option>
          <option value="best-selling" {% if collection.sort_by == 'best-selling' %}selected{% endif %}>
            Best Selling
          </option>
          <option value="title-ascending" {% if collection.sort_by == 'title-ascending' %}selected{% endif %}>
            Alphabetically, A-Z
          </option>
          <option value="title-descending" {% if collection.sort_by == 'title-descending' %}selected{% endif %}>
            Alphabetically, Z-A
          </option>
          <option value="price-ascending" {% if collection.sort_by == 'price-ascending' %}selected{% endif %}>
            Price, Low to High
          </option>
          <option value="price-descending" {% if collection.sort_by == 'price-descending' %}selected{% endif %}>
            Price, High to Low
          </option>
          <option value="created-ascending" {% if collection.sort_by == 'created-ascending' %}selected{% endif %}>
            Date, Old to New
          </option>
          <option value="created-descending" {% if collection.sort_by == 'created-descending' %}selected{% endif %}>
            Date, New to Old
          </option>
        </select>
      </div>
    {% comment %} Clear ALL filter {% endcomment %}
    
    {% if has_active_filters %}
      <div class="clear-all-btn">    
      <a href="{{ collection.url }}">Clear all Filters</a>
      </div>
    {% endif %}

    <button type="submit" style="width: 100%; padding: 12px; background: #000; color: #fff; border: none; cursor: pointer; margin-top: 10px;">Apply Filters</button>
    

    

</form>

        {% comment %} Active Filters Display {% endcomment %}
        {% if has_active_filters %}
          <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd;">
            <h4 style="margin-bottom: 10px; font-size: 14px;">Active Filters:</h4>
            
            {% for filter in collection.filters %}
              {% for value in filter.active_values %}
                <div style="display: inline-block; background: #000; color: #fff; padding: 5px 10px; margin: 5px 5px 0 0; font-size: 12px; border-radius: 3px;">
                  {{ filter.label }}: {{ value.label }}
                  <a href="{{ value.url_to_remove }}" style="color: #fff; margin-left: 5px; text-decoration: none; font-weight: bold;">✕</a>
                </div>
              {% endfor %}
              {% comment %} Price Active {% endcomment %}
                {% if filter.type == 'price_range' %}
                {% if filter.min_value.value or filter.max_value.value %}
                  <div style="display: inline-block; background: #000; color: #fff; padding: 5px 10px; margin: 5px 5px 0 0; font-size: 12px; border-radius: 3px;">
                    Price: ${{ filter.min_value.value | divided_by: 100}} - ${{ filter.max_value.value | divided_by: 100 }}
                    <a href="{{ filter.url_to_remove }}" style="color: #fff; margin-left: 5px; text-decoration: none; font-weight: bold;">✕</a>
                    </div>
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
        
    </aside>
      
  </div>

  {% comment %} Main Section {% endcomment %}
  <div class="section">
    <div class="section-heading"><h3>{{collection.title}}</h3>
    <p>{{collection.description}}</p></div>
 
    
    <div class="collection-wrapper">
      
     
      {% comment %} PRODUCTS AREA {% endcomment %}
      <div class="products-container">
        <div class="product-heading-bar">

          {% comment %} Filter Button {% endcomment %}
          <div class="title"><h2>{{collection.title}}</h2></div>
          <div class="filter-icon">
            <button class="filter-button">
              {% render 'filter-icon' %} 
            </button>
           Filter
          </div>
        </div>
        
        {% paginate collection.products by 12 %}
          
          <div class="products-grid">
            {% if collection.products.size > 0 %}
              {% for product in collection.products %}
                
                <div class="product-card">
                  
                  {% comment %} Product Image {% endcomment %}
                  <div class="product-image">
                    {% if product.featured_image %}
                      <a href="{{ product.url }}">
                       <img
                            src="{{ product.featured_image | image_url: width: 400 }}"
                            alt="{{ product.title | escape }}"
                            width="400"
                            height="{{ product.featured_image.height | divided_by: product.featured_image.width | times: 400 | round }}"
                            loading="lazy"
                        />
                      </a>
                    {% else %}
                      <div class="product-image-placeholder">No image</div>
                    {% endif %}
                  </div>
                  
                  {% comment %} Product Info {% endcomment %}
                  <div class="product-info">
                    <h2>
                      <a href="{{ product.url }}">{{ product.title }}</a>
                    </h2>
                    
                    {% comment %} Product Price {% endcomment %}
                    <div class="product-price">
                      {% if product.compare_at_price > product.price %}
                         {% comment %} On Sale  {% endcomment %}
                        <span class="price-sale">{{ product.price | money }}</span>
                        <span class="price-compare">{{ product.compare_at_price | money }}</span>
                      {% else %}
                        {% comment %} Regular Price {% endcomment %}
                        <span class="price-regular">{{ product.price | money }}</span>
                      {% endif %}
                    </div>
                     {% comment %} Product Description  {% endcomment %}
                    {% if product.description != blank %}
                      <p class="product-description">{{ product.description | strip_html | truncate: 100 }}</p> 
                    {% endif %}
                  </div>

                {% comment %} Quick Add to Cart {% endcomment %}
             {% comment %} Add to Cart Button {% endcomment %}
                {% if product.available %}
                {% if product.has_only_default_variant %}
                    {% comment %} Single variant - quick add {% endcomment %}
                    <button 
                    class="add-to-cart-btn"
                    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    data-product-title="{{ product.title | escape }}"
                    >
                    Add to Cart
                    </button>
                {% else %}
                    {% comment %} Multiple variants - go to product page {% endcomment %}
                    <a href="{{ product.url }}" class="add-to-cart-btn add-to-cart-link">
                    Select Variant
                    </a>
                {% endif %}
                {% else %}
                {% comment %} Sold out {% endcomment %}
                <button class="add-to-cart-btn add-to-cart-sold-out" disabled>
                    Sold Out
                </button>
                {% endif %}
                  
                </div>
              {% endfor %}
            {% else %}
              <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #666;">
                <h3>No products found</h3>
                <p>Try adjusting your filters or <a href="{{ collection.url }}" style="color: #000; text-decoration: underline;">clear all filters</a>.</p>
              </div>
            {% endif %}
          </div>
          
          {% if paginate.pages > 1 %}
            <div class="pagination">
              {% if paginate.previous %}
                <a href="{{paginate.previous.url}}">← Previous</a> 
              {% endif %}
              <span>Page {{paginate.current_page}} of {{paginate.pages}}</span>
              {% if paginate.next %}
                <a href="{{paginate.next.url}}">Next →</a>
              {% endif %}
            </div>
          {% endif %}
          
        {% endpaginate %}
      </div>
      
    </div>
  </div>
      

</div>
</section>


 <script src="{{ 'custom-collection.js' | asset_url }}" defer="defer"></script>

